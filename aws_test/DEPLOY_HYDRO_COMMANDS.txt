# Quick Copy-Paste Commands for AWS Hydrothermal Deployment
# ===========================================================
# Date: 2025-11-19
# After miller_urey run_4 completes

# ============================================================================
# STEP 1: Connect to AWS
# ============================================================================

ssh ubuntu@<YOUR_AWS_IP>


# ============================================================================
# STEP 2: Navigate and Pull Latest Code
# ============================================================================

cd ~/live2.0
git pull origin main


# ============================================================================
# STEP 3: Verify Cleanup (should show no processes)
# ============================================================================

ps aux | grep run_phase2_full | grep hydrothermal


# ============================================================================
# STEP 4: Quick Config Verification
# ============================================================================

# Check config exists
ls -lh aws_test/configs/phase2_hydrothermal_AWS_OPTIMIZED.yaml

# Verify critical settings
grep -E "n_particles|dt|cluster_check_interval|enable_mutations" aws_test/configs/phase2_hydrothermal_AWS_OPTIMIZED.yaml


# ============================================================================
# STEP 5: Start Queue (CHOOSE ONE METHOD)
# ============================================================================

# METHOD A: Interactive launcher (recommended)
bash aws_test/scripts/start_hydro_queue_aws.sh


# METHOD B: Manual background start
mkdir -p logs
chmod +x aws_test/scripts/auto_queue_restart_hydro.sh
nohup bash aws_test/scripts/auto_queue_restart_hydro.sh > logs/auto_restart_hydro.log 2>&1 &
echo "Queue started!"


# ============================================================================
# STEP 6: Verify Queue Started
# ============================================================================

# Check queue process (should show 1 line)
ps aux | grep auto_queue_restart_hydro | grep -v grep

# Wait 30 seconds for first runs to start
sleep 30

# Check simulations started (should show 1-4 processes)
ps aux | grep run_phase2_full | grep hydrothermal | grep -v grep


# ============================================================================
# STEP 7: Monitor Progress
# ============================================================================

# Quick check (run periodically)
python3 ~/live2.0/aws_test/scripts/check_actual_progress.py

# Watch main log
tail -f logs/auto_restart_hydro_main.log

# Watch specific run (example: run_1)
tail -f logs/hydro_run_1.log


# ============================================================================
# PERIODIC CHECKS (every few hours)
# ============================================================================

# Status summary
python3 ~/live2.0/aws_test/scripts/check_actual_progress.py

# Count completed runs
ls results/phase2b_additional/hydrothermal_extended/*/results.json 2>/dev/null | wc -l

# Check running processes
ps aux | grep run_phase2_full | grep hydrothermal | grep -v grep | wc -l


# ============================================================================
# AFTER COMPLETION (~35-45 hours)
# ============================================================================

# Verify all completed
ls results/phase2b_additional/hydrothermal_extended/*/results.json | wc -l
# Should show: 17

# Check total size
du -sh results/phase2b_additional/hydrothermal_extended/

# Stop queue (if still running)
pkill -f auto_queue_restart_hydro.sh


# ============================================================================
# DOWNLOAD RESULTS TO LOCAL MACHINE
# ============================================================================

# Run this on your LOCAL machine (Windows PowerShell):
# scp -r ubuntu@<AWS_IP>:~/live2.0/results/phase2b_additional/hydrothermal_extended ./aws_results/


# ============================================================================
# EMERGENCY STOP (if needed)
# ============================================================================

# Kill queue
pkill -f auto_queue_restart_hydro.sh

# Kill all hydrothermal simulations
pkill -f 'run_phase2_full.py.*hydrothermal'

# Verify stopped
ps aux | grep hydrothermal | grep -v grep


# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# Test config with quick run (1000 steps)
python3 scripts/run_phase2_full.py \
    --config aws_test/configs/phase2_hydrothermal_AWS_OPTIMIZED.yaml \
    --output /tmp/test_hydro \
    --steps 1000 \
    --seed 999 \
    --force-cpu

# Check if test completed
ls -lh /tmp/test_hydro/results.json

# View test log
tail -50 /tmp/test_hydro/simulation.log


# ============================================================================
# DISK SPACE CHECK
# ============================================================================

df -h
# Make sure you have at least 10 GB free


# ============================================================================
# NOTES
# ============================================================================

# - Queue manages 4 parallel simulations automatically
# - Total time: ~35-45 hours for 17 runs
# - Seeds: run_1=100, run_2=101, ..., run_17=116
# - Config: phase2_hydrothermal_AWS_OPTIMIZED.yaml
# - Auto-restart: Yes (queue will restart failed runs)
# - Monitoring: check_actual_progress.py every few hours

