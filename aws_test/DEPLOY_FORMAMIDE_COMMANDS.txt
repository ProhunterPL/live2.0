# Quick Copy-Paste Commands for AWS Formamide Deployment
# ======================================================
# Date: 2025-11-19
# After hydrothermal runs complete

# ============================================================================
# STEP 1: Connect to AWS
# ============================================================================

ssh ubuntu@<YOUR_AWS_IP>


# ============================================================================
# STEP 2: Navigate and Pull Latest Code
# ============================================================================

cd ~/live2.0
git pull origin main


# ============================================================================
# STEP 3: Verify Cleanup (should show no processes)
# ============================================================================

ps aux | grep run_phase2_full | grep formamide


# ============================================================================
# STEP 4: Quick Config Verification
# ============================================================================

# Check config exists
ls -lh aws_test/configs/phase2_formamide_AWS_OPTIMIZED.yaml

# Verify critical settings
grep -E "n_particles|dt|cluster_check_interval|enable_mutations" aws_test/configs/phase2_formamide_AWS_OPTIMIZED.yaml

# Expected output:
# n_particles: 1000
# dt: 0.002
# cluster_check_interval: 999999999  # DISABLED
# enable_mutations: false


# ============================================================================
# STEP 5: Start Queue (CHOOSE ONE METHOD)
# ============================================================================

# METHOD A: Interactive launcher (recommended)
bash aws_test/scripts/start_formamide_queue_aws.sh


# METHOD B: Manual background start
mkdir -p logs
chmod +x aws_test/scripts/auto_queue_restart_formamide.sh
nohup bash aws_test/scripts/auto_queue_restart_formamide.sh > logs/auto_restart_formamide.log 2>&1 &
echo "Queue started!"


# ============================================================================
# STEP 6: Verify Queue Started
# ============================================================================

# Check queue process
ps aux | grep auto_queue_restart_formamide

# Wait 30 seconds, then check if simulations starting
sleep 30
ps aux | grep run_phase2_full | grep formamide

# Check logs
tail -f logs/auto_restart_formamide_main.log


# ============================================================================
# MONITORING COMMANDS (use anytime)
# ============================================================================

# Quick status
python3 ~/live2.0/aws_test/scripts/check_actual_progress.py

# Main log
tail -f logs/auto_restart_formamide_main.log

# Progress log
tail -f logs/auto_restart_formamide_progress.log

# Specific run (e.g., run_1)
tail -f logs/formamide_run_1.log

# Running processes
ps aux | grep run_phase2_full | grep formamide

# Count completed
ls -d results/phase2b_additional/formamide_extended/run_*/results.json 2>/dev/null | wc -l


# ============================================================================
# STOPPING (if needed)
# ============================================================================

# Stop queue (won't kill running simulations)
pkill -f auto_queue_restart_formamide.sh

# Kill all formamide simulations
pkill -f "run_phase2_full.py.*formamide"


# ============================================================================
# POST-COMPLETION VERIFICATION
# ============================================================================

# Check all 8 runs completed
ls -d results/phase2b_additional/formamide_extended/run_*/results.json | wc -l
# Should show: 8

# List all runs
ls -lh results/phase2b_additional/formamide_extended/

# Backup to local (before terminating AWS)
# scp -r ubuntu@<AWS_IP>:~/live2.0/results/phase2b_additional/formamide_extended ./

